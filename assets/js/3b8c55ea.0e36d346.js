"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[217],{6995:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=s(5893),r=s(1151);const i={sidebar_position:2},a="Installation and setup",o={id:"installation",title:"Installation and setup",description:"In order to install Reassure run following command in your app folder:",source:"@site/docs/installation.md",sourceDirName:".",slug:"/installation",permalink:"/reassure/docs/installation",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Why Reassure?",permalink:"/reassure/docs/introduction"},next:{title:"Methodology",permalink:"/reassure/docs/methodology"}},l={},c=[{value:"Writing your first test",id:"writing-your-first-test",level:2},{value:"Writing async tests",id:"writing-async-tests",level:3},{value:"Measuring test performance",id:"measuring-test-performance",level:2},{value:"CI setup",id:"ci-setup",level:2},{value:"Options",id:"options",level:3},{value:"<code>--verbose</code> (optional)",id:"--verbose-optional",level:4},{value:"<code>--silent</code> (optional)",id:"--silent-optional",level:4},{value:"Scaffolding",id:"scaffolding",level:3},{value:"CI Script (<code>reassure-tests.sh</code>)",id:"ci-script-reassure-testssh",level:4},{value:"Dangerfile",id:"dangerfile",level:4},{value:"<code>.gitignore</code>",id:"gitignore",level:4},{value:"CI Script (<code>reassure-tests.sh</code>)",id:"ci-script-reassure-testssh-1",level:3},{value:"Integration",id:"integration",level:3},{value:"Updating existing <code>dangerfile</code>",id:"updating-existing-dangerfile",level:4},{value:"Creating Dangerfile",id:"creating-dangerfile",level:4},{value:"Updating the CI configuration file",id:"updating-the-ci-configuration-file",level:4},{value:"Optional: ESLint setup",id:"optional-eslint-setup",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"installation-and-setup",children:"Installation and setup"}),"\n",(0,t.jsx)(n.p,{children:"In order to install Reassure run following command in your app folder:"}),"\n",(0,t.jsx)(n.p,{children:"Using yarn"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"yarn add --dev reassure\n"})}),"\n",(0,t.jsx)(n.p,{children:"Using npm"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"npm install --save-dev reassure\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You will also need a working ",(0,t.jsx)(n.a,{href:"https://jestjs.io/docs/getting-started",children:"Jest"})," setup as well as one of either ",(0,t.jsx)(n.a,{href:"https://github.com/callstack/react-native-testing-library#installation",children:"React Native Testing Library"})," or ",(0,t.jsx)(n.a,{href:"https://testing-library.com/docs/react-testing-library/intro",children:"React Testing Library"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You can check our example projects:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/native",children:"React Native (CLI)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/native-expo",children:"React Native (Expo)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/web-nextjs",children:"React (Next.js)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/web-vite",children:"React (Vite)"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Reassure will try to detect which Testing Library you have installed. In case both React Native Testing Library and React Testing Library are present it will\nwarn you about that and give a precedence to React Native Testing Library. You can explicitly specify Testing Library to by used by using ",(0,t.jsx)(n.a,{href:"#configure-function",children:(0,t.jsx)(n.code,{children:"configure"})})," option:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"configure({ testingLibrary: 'react-native' });\n// or\nconfigure({ testingLibrary: 'react' });\n"})}),"\n",(0,t.jsx)(n.p,{children:"You should set it in your Jest setup file and you can override it in particular test files if needed."}),"\n",(0,t.jsx)(n.h2,{id:"writing-your-first-test",children:"Writing your first test"}),"\n",(0,t.jsxs)(n.p,{children:["Now that the library is installed, you can write you first test scenario in a file with ",(0,t.jsx)(n.code,{children:".perf-test.js"}),"/",(0,t.jsx)(n.code,{children:".perf-test.tsx"})," extension:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// ComponentUnderTest.perf-test.tsx\nimport { measurePerformance } from 'reassure';\n\ntest('Simple test', async () => {\n  await measurePerformance(<ComponentUnderTest />);\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This test will measure render times of ",(0,t.jsx)(n.code,{children:"ComponentUnderTest"})," during mounting and resulting sync effects."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": Reassure will automatically match test filenames using Jest's ",(0,t.jsx)(n.code,{children:"--testMatch"})," option with value ",(0,t.jsx)(n.code,{children:'"<rootDir>/**/*.perf-test.[jt]s?(x)"'}),". However, if you would like to pass a custom ",(0,t.jsx)(n.code,{children:"--testMatch"})," option, you may add it to the ",(0,t.jsx)(n.code,{children:"reassure measure"})," script in order to pass your own glob. More about ",(0,t.jsx)(n.code,{children:"--testMatch"})," in ",(0,t.jsx)(n.a,{href:"https://jestjs.io/docs/configuration#testmatch-arraystring",children:"Jest docs"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"writing-async-tests",children:"Writing async tests"}),"\n",(0,t.jsxs)(n.p,{children:["If your component contains any async logic or you want to test some interaction you should pass the ",(0,t.jsx)(n.code,{children:"scenario"})," option:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { measurePerformance } from 'reassure';\nimport { screen, fireEvent } from '@testing-library/react-native';\n\ntest('Test with scenario', async () => {\n  const scenario = async () => {\n    fireEvent.press(screen.getByText('Go'));\n    await screen.findByText('Done');\n  };\n\n  await measurePerformance(<ComponentUnderTest />, { scenario });\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The body of the ",(0,t.jsx)(n.code,{children:"scenario"})," function is using familiar React Native Testing Library methods."]}),"\n",(0,t.jsxs)(n.p,{children:["In case of using a version of React Native Testing Library lower than v10.1.0, where ",(0,t.jsxs)(n.a,{href:"https://callstack.github.io/react-native-testing-library/docs/api/#screen",children:[(0,t.jsx)(n.code,{children:"screen"})," helper"]})," is not available, the ",(0,t.jsx)(n.code,{children:"scenario"})," function provides it as its first argument:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { measurePerformance } from 'reassure';\nimport { fireEvent } from '@testing-library/react-native';\n\ntest('Test with scenario', async () => {\n  const scenario = async (screen) => {\n    fireEvent.press(screen.getByText('Go'));\n    await screen.findByText('Done');\n  };\n\n  await measurePerformance(<ComponentUnderTest />, { scenario });\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If your test contains any async changes, you will need to make sure that the scenario waits for these changes to settle, e.g. using\n",(0,t.jsx)(n.code,{children:"findBy"})," queries, ",(0,t.jsx)(n.code,{children:"waitFor"})," or ",(0,t.jsx)(n.code,{children:"waitForElementToBeRemoved"})," functions from RNTL."]}),"\n",(0,t.jsx)(n.p,{children:"For more examples look into our example apps:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/native",children:"React Native (CLI)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/native-expo",children:"React Native (Expo)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/web-nextjs",children:"React (Next.js)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure-examples/tree/main/examples/web-vite",children:"React (Vite)"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"measuring-test-performance",children:"Measuring test performance"}),"\n",(0,t.jsx)(n.p,{children:"In order to measure your first test performance you need to run following command in terminal:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"yarn reassure\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This command will run your tests multiple times using Jest, gathering render statistics, and will write them to\n",(0,t.jsx)(n.code,{children:".reassure/current.perf"})," file. In order to check your setup, check if the output file exists after running the\ncommand for the first time."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," You can add ",(0,t.jsx)(n.code,{children:".reassure/"})," folder to your ",(0,t.jsx)(n.code,{children:".gitignore"})," file to avoid accidentally committing your results."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Reassure CLI will automatically try to detect your source code branch name and commit hash when you are using Git. You can override these options, e.g. if you are using different version control system:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"yarn reassure --branch [branch name] --commit-hash [commit hash]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"ci-setup",children:"CI setup"}),"\n",(0,t.jsx)(n.p,{children:"To make setting up Reassure more convenient we have prepared a CLI command which will generate all necessary templates for you to get started with."}),"\n",(0,t.jsx)(n.p,{children:"Simply run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn reassure init\n"})}),"\n",(0,t.jsx)(n.p,{children:"This will generate the following file structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u251c\u2500\u2500 <ROOT>\n\u2502   \u251c\u2500\u2500 reassure-tests.sh\n\u2502   \u251c\u2500\u2500 dangerfile.ts/js (or dangerfile.reassure.ts/js if dangerfile.ts/js already present)\n\u2502   \u2514\u2500\u2500 .gitignore (append)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,t.jsx)(n.p,{children:"You can also use the following options in order to further adjust the script"}),"\n",(0,t.jsxs)(n.h4,{id:"--verbose-optional",children:[(0,t.jsx)(n.code,{children:"--verbose"})," (optional)"]}),"\n",(0,t.jsx)(n.p,{children:"This is one of the options controlling the level of logs printed into the command prompt while running reassure scripts. It will"}),"\n",(0,t.jsxs)(n.h4,{id:"--silent-optional",children:[(0,t.jsx)(n.code,{children:"--silent"})," (optional)"]}),"\n",(0,t.jsx)(n.p,{children:"Just like the previous, this option also controls the level of logs. It will suppress all logs besides explicit errors."}),"\n",(0,t.jsx)(n.h3,{id:"scaffolding",children:"Scaffolding"}),"\n",(0,t.jsxs)(n.h4,{id:"ci-script-reassure-testssh",children:["CI Script (",(0,t.jsx)(n.code,{children:"reassure-tests.sh"}),")"]}),"\n",(0,t.jsx)(n.p,{children:"Basic script allowing you to run Reassure on CI. More on the importance and structure of this file in the next section."}),"\n",(0,t.jsx)(n.h4,{id:"dangerfile",children:"Dangerfile"}),"\n",(0,t.jsxs)(n.p,{children:["If your project already contains a ",(0,t.jsx)(n.code,{children:"dangerfile"}),", the CLI will not override it in any way. Instead, it will generate a ",(0,t.jsx)(n.code,{children:"dangerfile.reassure.ts"})," file which will allow you to compare and update your own at your own convenience."]}),"\n",(0,t.jsx)(n.h4,{id:"gitignore",children:(0,t.jsx)(n.code,{children:".gitignore"})}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:".gitignore"})," file is present and no mentions of ",(0,t.jsx)(n.code,{children:"reassure"})," appear within it, the script will append the ",(0,t.jsx)(n.code,{children:".reassure/"})," directory to its end."]}),"\n",(0,t.jsxs)(n.h3,{id:"ci-script-reassure-testssh-1",children:["CI Script (",(0,t.jsx)(n.code,{children:"reassure-tests.sh"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["In order to detect performance changes, you need to measure the performance of two versions of your code\ncurrent (your modified code), and baseline (your reference point, e.g. ",(0,t.jsx)(n.code,{children:"main"})," branch). In order to measure performance\non two different branches you need to either switch branches in git or clone two copies of your repository."]}),"\n",(0,t.jsxs)(n.p,{children:["We want to automate this task, so it can run on the CI. In order to do that you will need to create a\nperformance testing script. You should save it in your repository, e.g. as ",(0,t.jsx)(n.code,{children:"reassure-tests.sh"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"A simple version of such script, using branch changing approach is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'#!/usr/bin/env bash\nset -e\n\nBASELINE_BRANCH=${BASELINE_BRANCH:="main"}\n\n# Required for `git switch` on CI\ngit fetch origin\n\n# Gather baseline perf measurements\ngit switch "$BASELINE_BRANCH"\nyarn install --force\nyarn reassure --baseline\n\n# Gather current perf measurements & compare results\ngit switch --detach -\nyarn install --force\nyarn reassure\n'})}),"\n",(0,t.jsx)(n.h3,{id:"integration",children:"Integration"}),"\n",(0,t.jsx)(n.p,{children:"As a final setup step you need to configure your CI to run the performance testing script and output the result.\nFor presenting output at the moment we integrate with Danger JS, which supports all major CI tools."}),"\n",(0,t.jsxs)(n.h4,{id:"updating-existing-dangerfile",children:["Updating existing ",(0,t.jsx)(n.code,{children:"dangerfile"})]}),"\n",(0,t.jsxs)(n.p,{children:["You will need a working ",(0,t.jsx)(n.a,{href:"https://danger.systems/js/guides/getting_started.html",children:"Danger JS setup"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Then add Reassure Danger JS plugin to your dangerfile :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// /<project_root>/dangerfile.reassure.ts (generated by the init script)\n\nimport path from 'path';\nimport { dangerReassure } from 'reassure';\n\ndangerReassure({\n  inputFilePath: path.join(__dirname, '.reassure/output.md'),\n});\n"})}),"\n",(0,t.jsx)(n.h4,{id:"creating-dangerfile",children:"Creating Dangerfile"}),"\n",(0,t.jsxs)(n.p,{children:["If you do not have a Dangerfile (",(0,t.jsx)(n.code,{children:"dangerfile.js"})," or ",(0,t.jsx)(n.code,{children:"dangerfile.ts"}),") yet, you can use the one generated by the ",(0,t.jsx)(n.code,{children:"reassure init"})," script without making any additional changes."]}),"\n",(0,t.jsxs)(n.p,{children:["You can also find it in our example file ",(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure/blob/main/dangerfile.ts",children:"Dangerfile"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"updating-the-ci-configuration-file",children:"Updating the CI configuration file"}),"\n",(0,t.jsx)(n.p,{children:"Finally run both performance testing script & danger in your CI config:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: Run performance testing script\n  run: ./reassure-tests.sh\n\n- name: Run Danger.js\n  run: yarn danger ci\n  env:\n    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can also check our example ",(0,t.jsx)(n.a,{href:"https://github.com/callstack/reassure/blob/main/.github/workflows/main.yml",children:"GitHub workflow"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The above example is based on GitHub Actions, but it should be similar to other CI config files and should only serve as a reference in such cases."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": Your performance test will run much longer than regular integration tests. It's because we run each test scenario multiple times (by default 10), and we repeat that for two branches of your code. Hence, each test will run 20 times by default. That's unless you increase that number even higher."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"optional-eslint-setup",children:"Optional: ESLint setup"}),"\n",(0,t.jsxs)(n.p,{children:["ESLint might require you to have at least one ",(0,t.jsx)(n.code,{children:"expect"})," statement in each of your tests. In order to avoid this requirement\nfor performance tests you can add following override to your ",(0,t.jsx)(n.code,{children:".eslintrc"})," file:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"rules: {\n 'jest/expect-expect': [\n 'error',\n    { assertFunctionNames: ['expect', 'measurePerformance'] },\n  ],\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>a});var t=s(7294);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);